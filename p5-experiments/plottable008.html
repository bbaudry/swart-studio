<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/p5.js-svg@1.5.1"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <script>
        //pixel = dpi * mm / 25.4 mm
        //A3: 297mm Ã— 420mm
        //96dpi is for plotting on the UUNA TEK iDraw
        //w=96*297/25.4=1122.5
        //h=96*420/25.4=1587.4
        var echelle = 0.5
        var w = 1122 * echelle
        var h = 1587 * echelle
        var leftmargin = 36
        var righttmargin = 36
        var topmargin = 45
        var bottommargin = 48
        var cnv, svgbtn

        function setup() {
            cnv = createCanvas(w, h, SVG);
            centerCanvas();
            colorMode(HSB, 360, 100, 100, 250);
            strokeCap(SQUARE)
            svgbtn = createButton("save svg");
            placebtn();
            svgbtn.mouseClicked(savesvg);
            background(0, 0, 0)
            noFill()
            noLoop()
        }

        function centerCanvas() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            cnv.position(x, y);
        }

        function placebtn() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            svgbtn.position(x - 200, y + h / 2 + 42)
        }

        function savesvg() {
            save("plottable006.svg");
        }
        var step = 100
        var offset = 20
        function draw() {
            driftingtriangles()
        }

        function testtriangles(){
            stroke(0, 0, 100);
            for (var x = 0; x < w - step; x += step + offset) {
                for (var y = 0; y < h - step; y += 2 * step + 4 * offset) {
                    triangle(x, y, x + step, y, x + step / 2, y + step)
                    triangle(x + step + offset / 2, y + offset, x + step + step / 2 + offset / 2, y + step + offset, x + step - step / 2 + offset / 2, y + step + offset)
                }
            }
            stroke(0, 100, 100);
            for (var x = step / 2; x < w - step; x += step) {
                for (var y = step + 2 * offset; y < h - step; y += 2 * step) {
                    triangle(x, y, x + step, y, x + step / 2, y + step)
                }
            }
        }

        var gap = 100;   
        var offset = 10; 
        function driftingtriangles() {
            var odd = false;
            var lines = [];
            for (var y = gap / 2; y <= h; y += gap) {
                odd = !odd;
                lineA = [];
                for (var x = gap / 4; x <= w; x += gap) {
                    lineA.push({
                        t: x + (Math.random() * .4 - .4) * gap + (odd ? gap / 2 : 0),
                        y: y + (Math.random() * .4 - .4) * gap
                    });
                }
                showline(odd,lineA)
                lines.push(lineA)
            }
            var dotLine;
            odd = true;
            stroke(0, 0, 100);
            strokeWeight(2);
            for (var y = 0; y < lines.length - 1; y++) {
                odd = !odd;
                dotLine = [];
                for (var i = 0; i < lines[y].length; i++) {
                    if(odd){
                        dotLine.push(lines[y][i])
                    }
                    else{
                        dotLine.push(lines[y+1][i])
                    }
                    dotLine.push(odd ? lines[y + 1][i] : lines[y][i]);
                }
                for (var i = 0; i < dotLine.length - 2; i++) {
                    triangle(dotLine[i].t, dotLine[i].y, dotLine[i + 1].t, dotLine[i + 1].y, dotLine[i + 2].t, dotLine[i + 2].y);
                }
            }
        }

        function showline(odd,lineA){
            odd?stroke(230,100,100) : stroke(30,100,100);
            stroke(30,100,100)
            for(var i=0;i<lineA.length;i++){
                ellipse(lineA[i].t, lineA[i].y, 7,7)
            }
        }
    </script>
</body>

</html>