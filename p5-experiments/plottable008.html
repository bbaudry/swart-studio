<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/p5.js-svg@1.5.1"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <script>
        //pixel = dpi * mm / 25.4 mm
        //A3: 297mm Ã— 420mm
        //96dpi is for plotting on the UUNA TEK iDraw
        //w=96*297/25.4=1122.5
        //h=96*420/25.4=1587.4
        var echelle = 0.5
        var w = 1122 * echelle
        var h = 1587 * echelle
        var leftmargin = 36
        var righttmargin = 36
        var topmargin = 45
        var bottommargin = 48
        var cnv, imgbtn

        function setup() {
            getsvg()
            //getpng()
            centerCanvas();
            colorMode(HSB, 360, 100, 100, 250);
            strokeCap(SQUARE)
            svgbtn = createButton("save svg");
            placebtn();
            svgbtn.mouseClicked(savesvg);
            noFill()
            background(0, 0, 0)            
            settrianglecoords()

//            noLoop()
        }

        function getsvg() {
            cnv = createCanvas(w, h, SVG);
            imgbtn = createButton("save svg");
            placebtn();
            imgbtn.mouseClicked(savesvg);
        }
        function getpng() {
            cnv = createCanvas(w, h);
            imgbtn = createButton("save png");
            placebtn();
            imgbtn.mouseClicked(savepng);
        }

        function centerCanvas() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            cnv.position(x, y);
        }

        function placebtn() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            imgbtn.position(x - 200, y + h / 2 + 42)
        }

        function savesvg() {
            save("plottable008.svg");
        }
        function savepng() {
            save("plottable008.png");
        }


        var gap = 100;
        var offset = 17;
        var lines;
        var triangles = []

        function draw() {
            //background(0,0,0)
            buildtriangles()
            drawtriangles()
            console.log(frameCount)
            offset += frameCount*0.1
            if (frameCount>42){noLoop()}
        }

        function settrianglecoords() {
            lines=[]
            var odd = false;
            for (var y = gap / 2; y <= h; y += gap) {
                odd = !odd;
                lineA = [];
                for (var x = gap / 4; x <= w; x += gap) {
                    lineA.push({
                        t: x + (Math.random() * .4 - .4) * gap + (odd ? gap / 2 : 0),
                        y: y + (Math.random() * .4 - .4) * gap
                    });
                }
                //showline(odd,lineA)
                lines.push(lineA)
            }
            var dotLine;
            odd = true;
            stroke(0, 0, 100);
            strokeWeight(1);
        }
        function drawtriangles() {
            for (var i = 0; i < triangles.length; i++) {
                var vera = triangles[i]
                triangle(
                    vera.x1,
                    vera.y1,
                    vera.x2,
                    vera.y2,
                    vera.x3,
                    vera.y3
                );
            }
        }
        function buildtriangles() {
            triangles=[]
            var odd = true
            for (var y = 0; y < lines.length - 1; y++) {
                odd = !odd;
                dotLine = [];
                if (odd) {
                    for (var i = 0; i < lines[y].length - 1; i++) {
                        triangles.push({
                            x1: lines[y + 1][i + 1].t - offset,
                            y1: lines[y + 1][i + 1].y - offset,
                            x2: lines[y + 1][i].t + offset,
                            y2: lines[y + 1][i].y - offset,
                            x3: lines[y][i + 1].t,
                            y3: lines[y][i + 1].y
                        })
                    }
                    for (var i = 0; i < lines[y].length - 2; i++) {
                        triangles.push({
                            x1: lines[y + 1][i].t,
                            y1: lines[y + 1][i].y - offset,
                            x2: lines[y][i].t + offset,
                            y2: lines[y][i].y,
                            x3: lines[y][i + 1].t - offset,
                            y3: lines[y][i + 1].y
                        })
                    }
                    var molnar = lines[y].length - 2
                    triangles.push({
                        x1: lines[y + 1][molnar].t,
                        y1: lines[y + 1][molnar].y - offset,
                        x2: lines[y][molnar].t + offset,
                        y2: lines[y][molnar].y,
                        x3: lines[y][molnar + 1].t - offset,
                        y3: lines[y][molnar + 1].y
                    })
                }
                else {
                    for (var i = 0; i < lines[y].length - 1; i++) {
                        triangles.push({
                            x1: lines[y + 1][i].t + offset,
                            y1: lines[y + 1][i].y - offset,
                            x2: lines[y + 1][i + 1].t - offset,
                            y2: lines[y + 1][i + 1].y - offset,
                            x3: lines[y][i].t,
                            y3: lines[y][i].y
                        })
                    }
                    for (var i = 0; i < lines[y].length - 2; i++) {
                        triangles.push({
                            x1: lines[y][i].t + offset,
                            y1: lines[y][i].y,
                            x2: lines[y][i + 1].t - offset,
                            y2: lines[y][i + 1].y,
                            x3: lines[y + 1][i + 1].t,
                            y3: lines[y + 1][i + 1].y - offset
                        })
                    }
                    var molnar = lines[y].length - 2
                    triangles.push({
                        x1: lines[y + 1][molnar + 1].t,
                        y1: lines[y + 1][molnar + 1].y - offset,
                        x2: lines[y][molnar + 1].t,
                        y2: lines[y][molnar + 1].y,
                        x3: lines[y][molnar].t + offset,
                        y3: lines[y][molnar].y
                    })
                }
            }
        }

        function showline(odd, lineA) {
            console.log(odd + " " + lineA.length)
            odd ? stroke(230, 100, 100) : stroke(30, 100, 100);
            strokeWeight(3)
            for (var i = 0; i < lineA.length; i++) {
                ellipse(lineA[i].t, lineA[i].y, 17, 17)
            }
        }
    </script>
</body>

</html>