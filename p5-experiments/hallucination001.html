<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <script>
        //global vars for the whole piece
        var w = 900;
        var h = 900;
        var cnv;
        var padding = 10
        let ox1 = padding
        let ox2 = w - padding
        let oy1 = padding
        let oy2 = h - padding
        let mint = 0.01
        let maxt = 0.1
        var sections;


        function setup() {
            cnv = createCanvas(w, h);
            centerCanvas();
            colorMode(HSB, 360, 100, 100, 250);
            strokeCap(SQUARE)
            background(0, 0, 0)
            stroke(0, 0, 100)
            initregular()
        }

        function centerCanvas() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            cnv.position(x, y);
        }


        function draw() {
            background(0, 0, 0)
            stroke(0, 0, 100)
            draw_sections()
            noLoop()
        }

        let down = false;
        function draw_sections() {
            
            line(padding, padding, padding, h - padding)
            line(w - padding, padding, w - padding, h - padding)
            for (sec in sections) {
                //sec=sections[4]
                for (s in sec) {
                    if (!down) {
                        sec[s][3] -= 5//random(1, 5)
                        if (sec[s][3] <= oy1) { sec[s][3] = oy1; }
                        line(sec[s][0], sec[s][1], sec[s][2], sec[s][3])
                    }
                    else {
                        sec[s][3] += 5//random(1, 5)
                        if (sec[s][3] >= oy2) { sec[s][3] = oy2; }
                        line(sec[s][0], sec[s][1], sec[s][2], sec[s][3])
                    }
                }
                if (done(sec,down)) { down = !down }
            }
        }

        function done(sec,down) {
            let res = true
            for (s in sec) {
                if (down && sec[s][3] != oy2) {
                    res = false
                }
                else {
                    if (!down && sec[s][3] != oy1) {
                        res = false
                    }
                }
            }
            return res
        }

        function initregular() {
            sections = []
            let x1, x2, y1, y2, t1, px1, px2, px3, px4, py1, py2, py3, py4, left, section
            t1 = 0;
            px1 = ox1; py1 = oy1; px2 = px1; py2 = oy2;
            px3 = px1 + random(100, 200); py3 = py1; px4 = px3; py4 = py2
            left = true
            while (px3 < ox2) {
                section = []
                while (t1 < 1) {
                    x1 = px1;
                    x2 = px3;
                    if (left) {
                        y1 = (1 - t1) * py1 + (t1 * py2);
                        y2 = py4;
                    }
                    else {
                        y1 = py4
                        y2 = (1 - t1) * py1 + (t1 * py2);;
                    }
                    section.push([x1, y1, x2, y2])
                    line(x1, y1, x2, y2)
                    t1 += 0.1;
                }
                sections.push(section)
                px1 = px3
                px3 = px1 + random(100, 200);
                if (px3 > ox2) { px3 = ox2 }
                left = !left
                t1=0
            }
            section = []
                while (t1 < 1) {
                    x1 = px1;
                    x2 = px3;
                    if (left) {
                        y1 = (1 - t1) * py1 + (t1 * py2);
                        y2 = py4;
                    }
                    else {
                        y1 = py4
                        y2 = (1 - t1) * py1 + (t1 * py2);;
                    }
                    section.push([x1, y1, x2, y2])
                    line(x1, y1, x2, y2)
                    t1 += 0.1;
                }
                sections.push(section)
            console.log("there are "+sections[1].length+" different sections")
        }


        function init() {
            sections = []
            let x1, x2, y1, y2, t1, t2
            t1 = 0; t2 = 0;
            while (t1 < 1 || t2 < 1) {
                t1 += random(mint, maxt);
                t2 += random(mint, maxt);
                if (t1 >= 1) { t1 = 1 }
                if (t2 >= 1) { t2 = 1 }
                x1 = ox1;
                y1 = (1 - t1) * oy1 + (t1 * oy2);
                x2 = ox2;
                y2 = (1 - t2) * oy1 + (t2 * oy2);
                sections.push([x1, y1, x2, y2])
            }
        }

    </script>
</body>

</html>