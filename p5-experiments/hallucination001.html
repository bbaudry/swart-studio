<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <script>
        //global vars for the whole piece
        var w = 900;
        var h = 900;
        var cnv;
        var padding = 10
        let ox1 = padding
        let ox2 = w - padding
        let oy1 = padding
        let oy2 = h - padding
        let mint = 0.01
        let maxt = 0.1
        var sections;


        function setup() {
            cnv = createCanvas(w, h);
            centerCanvas();
            colorMode(HSB, 360, 100, 100, 250);
            strokeCap(SQUARE)
            init()
        }

        function centerCanvas() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            cnv.position(x, y);
        }


        function draw() {
            background(0, 0, 0)
            draw_sections()
            //noLoop()
        }
        
        let down=false;
        function draw_sections() {
            stroke(0, 0, 100)
            line(padding, padding, padding, h - padding)
            line(w - padding, padding, w - padding, h - padding)
            for (s in sections) {
                if (!down) {
                    sections[s][3] -= random(1, 5)
                    if (sections[s][3] <= oy1) { sections[s][3] = oy1; }
                    line(sections[s][0], sections[s][1], sections[s][2], sections[s][3])
                }
                else{
                    sections[s][3] += random(1, 5)
                    if (sections[s][3] >= oy2) { sections[s][3] = oy2; }
                    line(sections[s][0], sections[s][1], sections[s][2], sections[s][3])
                }
            }
            if(done(down)) {down=!down}
        }

        function done(down){
            let res=true
            for (s in sections){
                if (down && sections[s][3] != oy2){
                    res = false
                }
                else{
                if (!down && sections[s][3] != oy1){
                    res = false
                }}
            }
            return res
        }
        
        function init() {
            sections = []
            let x1, x2, y1, y2, t1, t2
            t1 = 0; t2 = 0;
            while (t1 < 1 || t2 < 1) {
                t1 += random(mint, maxt);
                t2 += random(mint, maxt);
                if (t1 >= 1) { t1 = 1 }
                if (t2 >= 1) { t2 = 1 }
                x1 = ox1;
                y1 = (1 - t1) * oy1 + (t1 * oy2);
                x2 = ox2;
                y2 = (1 - t2) * oy1 + (t2 * oy2);
                sections.push([x1, y1, x2, y2])
            }
        }

    </script>
</body>

</html>