<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/p5.js-svg@1.5.1"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <script>
        //297mm Ã— 420mm
        //pixel = dpi * mm / 25.4 mm
        //w=96*297/25.4=1122.5
        //h=96*420/25.4=1587.4
        var scale=0.5
        var h = 1587*scale
        var w = 1122*scale
        var leftmargin = 0.15*w
        var rightmargin = 0.85*w
        var topmargin = 0.2*h
        var bottommargin = 0.7*h
        var cnv, svgbtn
        var sections = []
        var sectionresolution = 0.025*w;
        var maxsizesection = 0.015*w;

        function setup() {
            cnv = createCanvas(w, h, SVG);
            centerCanvas();
            colorMode(HSB, 360, 100, 100, 250);
            strokeCap(SQUARE)
            svgbtn = createButton("save svg");
            placebtn();
            svgbtn.mouseClicked(savesvg);
            background(0, 0, 100)
            noFill()
        }

        function centerCanvas() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            cnv.position(x, y);
        }

        function placebtn() {
            var x = (windowWidth - w) / 2;
            var y = (windowHeight - h) / 2;
            svgbtn.position(x - 200, y + h / 2 + 42)
        }

        function savesvg() {
            save("plottable004.svg");
        }

        var resolution = 50
        var field = []

        function draw() {
            stroke(0,0,0);
            rect(0,0,w,h)
            rect(leftmargin,topmargin,(rightmargin-leftmargin),(bottommargin-topmargin))
            section()
            noLoop()
        }

        function section(){
            stroke(230,100,100)
            var x1,x2,x3,x4,y1,y2,y3,y4,offset,py,px,py1,py2,py3,py4,px1,px2,px3,px4,oy,dy,ox,dy,xt,yt
            offset=7
            x1=leftmargin
            y1=0.3*h
            x2=leftmargin+(rightmargin-leftmargin)/2
            y2=0.4*h
            x3=leftmargin+(rightmargin-leftmargin)/2
            y3=bottommargin
            x4=leftmargin
            y4=bottommargin-(0.1*h)
            quad(x1,y1,x2,y2,x3,y3,x4,y4)
            yt=0
            ellipse(x1,y1,7,7);ellipse(x2,y2,7,7);ellipse(x3,y3,7,7);ellipse(x4,y4,7,7);
            while( yt<1){
                var incy=random()
                if(yt+incy>=1){yt=1}
                else{yt+=incy}

                ox = (1 - yt) * x1 + (yt * x4)
                oy = (1 - yt) * y1 + (yt * y4);
                dx = (1 - yt) * x2 + (yt * x3)
                dy = (1 - yt) * y2 + (yt * y3);
                py1 = y1
                px1 = x1
                px4 = ox
                py4 = oy
                xt=0
                while(xt<=1){
                    xt+=random()
                    px2 = (1 - xt) * x1 + (xt * x2);
                    px3 = (1 - xt) * ox + (xt * dx);
                    py2 = (1 - xt) * y1 + (xt * y2);
                    py3 = (1 - xt) * oy + (xt * dy);
                    quad(px1,py1,px2,py2,px3,py3,px4,py4)
                    px1=px2;px4=px3
                    py1=py2;py4=py3
                }                
                y1=oy;y2=dy;x1=ox;x2=dx

            }
        }

    </script>
</body>

</html>