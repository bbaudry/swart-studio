<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="UTF-8">
    <script src="libraries/p5.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <script>
        //global vars for the whole piece
        var w = 900;
        var h = 900;
        var palette = [
            {
                back: [0, 0, 100],
                ray: [330, 80, 100, 84],
                city: [50, 100, 100]
            },
            {
                back: [0, 0, 0],
                ray: [0, 100, 100, 84],
                city: [0, 0, 100]
            },
            {
                back: [0, 0, 0],
                ray: [0, 0, 100, 84],
                city: [0, 100, 100]
            },
            {
                back: [230, 100, 50],
                ray: [50, 100, 100, 84],
                city: [330, 100, 100]
            }
        ]
        var back_color, ray_color, city_color


        function setup() {
            createCanvas(w, h);
            colorMode(HSB, 360, 100, 100, 250);
            choose_color()
        }

        function choose_color() {
            let c = Math.floor(random(palette.length))
            back_color = palette[c].back
            ray_color = palette[c].ray
            city_color = palette[c].city
        }

        function draw() {
            background(back_color[0], back_color[1], back_color[2]);
            random_display();
            noLoop();
        }

        var cell = 42;
        var pad=21
        var wmin=pad
        var hmin=pad
        var wmax=w-pad
        var hmax=h-pad

        function random_display() {
            let max = 20;
            noFill()
            stroke(city_color[0], city_color[1], city_color[2])
            var x1, y1, x2, y2, nbcellsw, nbcellsh, east, miny, maxy, shape;
            x1 = wmin
            y1 = hmin
            miny = wmin
            maxy = hmin
            east = true
            while (east) {
                nbcellsw = 1 + Math.floor(random(max))
                nbcellsh = 1 + Math.floor(random(max))
                if (y1 + nbcellsh * cell < miny) {
                    miny = y1 + nbcellsh * cell
                }
                else {
                    if (y1 + nbcellsh * cell > maxy) {
                        maxy = y1 + nbcellsh * cell
                        if (miny == y1) { 
                            miny = y1 + nbcellsh * cell; 
                        }
                    }
                }
                if(y1 + nbcellsh * cell <=hmax){y2=y1 + nbcellsh * cell}
                else{y2=hmax}
                if (x1 + nbcellsw * cell < wmax) {
                    x2=x1 + nbcellsw * cell
                    quad(x1, y1, x2, y1, x2, y2, x1, y2)
                    x1 += nbcellsw * cell
                }
                else {
                    x2=wmax
                    quad(x1, y1, x2, y1, x2, y2, x1, y2)
                    if (miny + nbcellsh * cell < hmax) {
                        x1 = wmin
                        y1 = miny
                        maxy=miny
                    }
                    else {
                        var last = true
                        x1 = wmin
                        if(miny<hmax){y1=miny}
                        y2=hmax
                        console.log("last row with x1: "+x1+"; y1: "+y1+"; y2: "+y2)
                        while (last) {
                            nbcellsw = 1 + Math.floor(random(max))
                            if (x1 + nbcellsw * cell < wmax) {
                                x2=x1 + nbcellsw * cell
                                quad(x1, y1, x2, y1, x2, y2, x1, y2)
                                x1 += nbcellsw * cell
                            }
                            else {
                                x2=wmax
                                quad(x1, y1, x2, y1, x2, y2, x1, y2)
                                last = false
                            }
                        }
                        east = false
                    }
                }
            }
        }


    </script>
</body>

</html>